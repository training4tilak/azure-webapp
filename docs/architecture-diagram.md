# Architecture Diagram & Visual Guide

## ğŸ—ï¸ Complete System Architecture

### High-Level Three-Tier Architecture

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                        TIER 1: PRESENTATION                      â”ƒ
â”ƒ                     Azure Static Web App (SWA)                   â”ƒ
â”ƒ                                                                   â”ƒ
â”ƒ   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ   â”‚  React/Angular SPA (Client-Side JavaScript)            â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Hosted on global CDN                                â”‚   â”ƒ
â”ƒ   â”‚  â€¢ CORS enabled to Function App                        â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Automatic HTTPS (TLS 1.2+)                          â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Azure Entra ID authentication                       â”‚   â”ƒ
â”ƒ   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                                 â†“ HTTPS REST API
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    TIER 2: APPLICATION (BUSINESS LOGIC)          â”ƒ
â”ƒ                 Azure Function App (Serverless Compute)          â”ƒ
â”ƒ                                                                   â”ƒ
â”ƒ   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ   â”‚  Python 3.11 HTTP Trigger Functions                    â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Endpoints: /api/employees (CRUD operations)         â”‚   â”ƒ
â”ƒ   â”‚  â€¢ VNet Integration (private connectivity)             â”‚   â”ƒ
â”ƒ   â”‚  â€¢ System-Assigned Managed Identity                    â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Elastic Premium Plan (auto-scaling)                 â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Request: Parse, validate, authenticate              â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Response: Transform data, serialize JSON            â”‚   â”ƒ
â”ƒ   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”ƒ                                                                   â”ƒ
â”ƒ   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ   â”‚  Storage Account (Function State)                       â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Table Storage: Function state                        â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Blob Storage: Large payloads                         â”‚   â”ƒ
â”ƒ   â”‚  â€¢ GRS replication (redundancy)                         â”‚   â”ƒ
â”ƒ   â”‚  â€¢ HTTPS-only, no shared keys                           â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Accessed via Managed Identity                        â”‚   â”ƒ
â”ƒ   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                           â†“ Private Endpoint
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    TIER 3: DATA (PERSISTENCE)                    â”ƒ
â”ƒ                   Azure Cosmos DB (NoSQL Database)               â”ƒ
â”ƒ                                                                   â”ƒ
â”ƒ   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”ƒ
â”ƒ   â”‚  Cosmos DB SQL API Account                              â”‚   â”ƒ
â”ƒ   â”‚  Database: employeedb                                   â”‚   â”ƒ
â”ƒ   â”‚  Container: employees (partition key: /departmentId)   â”‚   â”ƒ
â”ƒ   â”‚                                                          â”‚   â”ƒ
â”ƒ   â”‚  Sample Document:                                       â”‚   â”ƒ
â”ƒ   â”‚  {                                                       â”‚   â”ƒ
â”ƒ   â”‚    "id": "emp123",                                      â”‚   â”ƒ
â”ƒ   â”‚    "name": "John Doe",                                  â”‚   â”ƒ
â”ƒ   â”‚    "departmentId": "eng",                               â”‚   â”ƒ
â”ƒ   â”‚    "email": "john@company.com",                         â”‚   â”ƒ
â”ƒ   â”‚    "_etag": "...",                                      â”‚   â”ƒ
â”ƒ   â”‚    "_ts": 1234567890                                    â”‚   â”ƒ
â”ƒ   â”‚  }                                                       â”‚   â”ƒ
â”ƒ   â”‚                                                          â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Multi-region replicas (East US 2 primary)           â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Automatic failover enabled                           â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Zone-redundant backup                                â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Private Endpoint only (no public access)            â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Dev: 400 RUs (provisioned)                           â”‚   â”ƒ
â”ƒ   â”‚  â€¢ Prod: 1000 RUs + autoscale to 4000 RUs              â”‚   â”ƒ
â”ƒ   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
```

---

## ğŸ” Security & Secrets Management

### Secrets Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Azure Key Vault (Secrets Storage)                  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Secrets (Only Authorized Identities Can Read):         â”‚  â”‚
â”‚  â”‚  â€¢ cosmos-db-endpoint: https://cosmos-xxx.documents... â”‚  â”‚
â”‚  â”‚  â€¢ cosmos-db-key: (NOT USED - uses Managed ID instead) â”‚  â”‚
â”‚  â”‚  â€¢ app-config: {...}                                    â”‚  â”‚
â”‚  â”‚  â€¢ database-password: (if using SQL DB)                â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  Properties:                                            â”‚  â”‚
â”‚  â”‚  â€¢ Soft-Delete: 90 days (accidental deletion safety)    â”‚  â”‚
â”‚  â”‚  â€¢ Purge Protection: Enabled (compliance)               â”‚  â”‚
â”‚  â”‚  â€¢ Private Endpoint: Only VNet access                   â”‚  â”‚
â”‚  â”‚  â€¢ RBAC: Secrets User role to Function App MSI         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘ RBAC: Function App MSI reads secrets
         â”‚
         â”‚
    Function App (System-Assigned MSI)
    
    Code Flow:
    1. Function App requests bearer token from Azure Entra ID
    2. Token includes Service Principal ID
    3. Function uses token to authenticate to Key Vault API
    4. Key Vault validates token, checks RBAC role
    5. If authorized â†’ Return secret value
    6. Credential never stored in code/config/env vars
    
    Audit Trail:
    â€¢ Who: Service Principal (function app identity)
    â€¢ What: ReadSecret operation
    â€¢ When: Timestamp
    â€¢ Status: Success/Failure
    â†’ Logged in Log Analytics for compliance
```

---

## ğŸŒ Networking & Data Flow

### Detailed Network Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     INTERNET (GLOBAL)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ HTTPS (443)
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Azure Static Web App (Global CDN)                               â”‚
â”‚          https://myapp.azurestaticapps.net/                              â”‚
â”‚          (Hosted in East US 2 region)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ REST API HTTPS (443)
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AZURE VIRTUAL NETWORK (10.0.0.0/16)                     â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         Function App Subnet (10.0.1.0/24)                            â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Azure Function App (Linux - Python 3.11)                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ DNS Name: func-employee-app-dev-abc123.azurewebsites.net â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Private IP (VNet): 10.0.1.10                              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ VNet Integration enabled                                  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ System-Assigned Managed Identity (SPN)                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  HTTP Trigger Functions:                                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ POST   /api/employees           (Create)                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ GET    /api/employees           (Read All)               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ GET    /api/employees/{id}      (Read One)               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ PUT    /api/employees/{id}      (Update)                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ DELETE /api/employees/{id}      (Delete)                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Dependencies:                                              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ @azure/cosmos (Python SDK)                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ app.config_read from Key Vault                           â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  NSG (Network Security Group):                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Inbound Rules:                                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ 443/TCP from ANY (Azure Functions platform)              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ Outbound Rules:                                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ 443/TCP to CosmosDB (service tag)                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ 443/TCP to KeyVault (service tag)                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ 443/TCP to Storage (service tag)                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ DENY ALL other traffic (implicit)                        â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚                                                                       â”‚ â”‚
â”‚  Service Endpoints (Microsoft backbone access):                       â”‚ â”‚
â”‚  â€¢ Microsoft.Storage                                                 â”‚ â”‚
â”‚  â€¢ Microsoft.CosmosDB                                                â”‚ â”‚
â”‚  â€¢ Microsoft.KeyVault                                                â”‚ â”‚
â”‚                                                                       â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚         Private Endpoints Subnet (10.0.2.0/24)                   â”‚ â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Private Endpoint: Cosmos DB                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Private IP: 10.0.2.10                                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ DNS Zone: cosmos.documents.azure.com (private)          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Linked to VNet Private DNS Zone                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Function App resolves to 10.0.2.10 (not public IP)      â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Private Endpoint: Key Vault                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Private IP: 10.0.2.11                                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ DNS Zone: vault.azure.net (private)                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Function App resolves to 10.0.2.11 (not public IP)      â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Private Endpoint: Storage Account                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Private IP: 10.0.2.12                                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ DNS Zone: blob.core.windows.net (private)               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Function App resolves to 10.0.2.12 (not public IP)      â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  NSG (Network Security Group):                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Inbound Rules:                                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ 443/TCP from VirtualNetwork ONLY (10.0.0.0/16)          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ DENY ALL other sources                                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ Outbound Rules:                                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ ALLOW ALL (services don't need outbound)                 â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚                                                                       â”‚ â”‚
â”‚  Route Table:                                                         â”‚ â”‚
â”‚  â€¢ 10.0.0.0/16 â†’ Local (intra-VNet routing)                          â”‚ â”‚
â”‚  â€¢ 0.0.0.0/0 â†’ Internet (via NAT, if configured)                     â”‚ â”‚
â”‚                                                                       â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ Private IP routing (10.0.2.x) - no internet
         â”‚ (Microsoft backbone only)
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND SERVICES (PRIVATE ACCESS)                       â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Cosmos DB Account (no public endpoint exposed)                       â”‚ â”‚
â”‚  â”‚  â€¢ Document DB SQL API                                               â”‚ â”‚
â”‚  â”‚  â€¢ Primary: East US 2                                                â”‚ â”‚
â”‚  â”‚  â€¢ Private connection only (via PE in 10.0.2.10)                    â”‚ â”‚
â”‚  â”‚  â€¢ Geo-replicated backup (zone-redundant)                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Key Vault (no public endpoint exposed)                               â”‚ â”‚
â”‚  â”‚  â€¢ Secrets: cosmos-endpoint, app-config, etc                          â”‚ â”‚
â”‚  â”‚  â€¢ Private connection only (via PE in 10.0.2.11)                     â”‚ â”‚
â”‚  â”‚  â€¢ RBAC: Function App MSI has "Secrets User" role                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Storage Account (no public endpoint exposed)                         â”‚ â”‚
â”‚  â”‚  â€¢ Table Storage: Function state & execution history                 â”‚ â”‚
â”‚  â”‚  â€¢ Blob Storage: Large file uploads                                  â”‚ â”‚
â”‚  â”‚  â€¢ Private connection only (via PE in 10.0.2.12)                    â”‚ â”‚
â”‚  â”‚  â€¢ GRS replication for redundancy                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Flow: Employee Creation

```
1. USER ACTION (Browser):
   POST /api/employees
   {
     "name": "Jane Smith",
     "email": "jane@company.com",
     "departmentId": "sales"
   }
   
2. STATIC WEB APP (CDN â†’ Function App):
   â€¢ JavaScript fetches /api/employees (CORS enabled)
   â€¢ Includes Authorization header (bearer token)
   â€¢ HTTPS encrypted
   
3. FUNCTION APP PROCESSING:
   Function receives request:
   â€¢ Validates input (name, email, departmentId required)
   â€¢ Extracts bearer token from Authorization header
   â€¢ Creates document object:
     {
       "id": "auto-generated-uuid",
       "name": "Jane Smith",
       "email": "jane@company.com",
       "departmentId": "sales",
       "createdDate": "2025-12-16T10:30:00Z",
       "_ts": 1702730400
     }
   
4. COSMOS DB INTERACTION:
   Function executes:
   ```python
   # Using Azure SDK with Managed Identity
   from azure.cosmos import CosmosClient
   
   # Token obtained automatically from Azure Entra ID
   client = CosmosClient(endpoint, token_credential=credential)
   container = client.get_database_client("employeedb").get_container_client("employees")
   
   # Insert document
   response = container.create_item(
       body=document,
       partition_key_value="sales"
   )
   ```
   
   Authorization check:
   â€¢ Function App MSI â†’ Entra ID â†’ Bearer token
   â€¢ Token sent to Cosmos DB
   â€¢ Cosmos DB validates token signature
   â€¢ Checks RBAC role: "Cosmos DB Built-in Data Contributor"
   â€¢ âœ“ Authorized â†’ Execute query
   â€¢ Document inserted with partition key "sales"
   
5. RESPONSE BACK TO CLIENT:
   HTTP 201 Created
   {
     "id": "emp-uuid-12345",
     "name": "Jane Smith",
     "email": "jane@company.com",
     "departmentId": "sales",
     "_ts": 1702730400
   }
   
6. AUDIT LOG:
   Log Analytics captures:
   {
     "timeGenerated": "2025-12-16T10:30:00Z",
     "operation": "CreateItem",
     "database": "employeedb",
     "container": "employees",
     "principal": "func-employee-app-dev.../System",
     "status": "Success",
     "responseTime": 125,  # milliseconds
     "ruConsumed": 5.2     # Request Units
   }
```

---

## ğŸ“Š Deployment Topology

### Dev Environment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Dev Subscription (cost-optimized)        â”‚
â”‚                                            â”‚
â”‚   â€¢ Static Web App: Free tier             â”‚
â”‚   â€¢ Function App: EP1 (shared scaling)    â”‚
â”‚   â€¢ Cosmos DB: 400 RUs (fixed, no auto)  â”‚
â”‚   â€¢ Log Analytics: 30-day retention       â”‚
â”‚   â€¢ Private Endpoints: DISABLED           â”‚
â”‚   â€¢ Cost: ~$95/month                      â”‚
â”‚                                            â”‚
â”‚   Use Case:                                â”‚
â”‚   âœ“ Development testing                   â”‚
â”‚   âœ“ Feature validation                    â”‚
â”‚   âœ“ Learning & training                   â”‚
â”‚   âœ— Production traffic (insufficient)    â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Prod Environment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Prod Subscription (high-availability)    â”‚
â”‚                                            â”‚
â”‚   â€¢ Static Web App: Standard tier (SLA)    â”‚
â”‚   â€¢ Function App: EP1 (premium scaling)    â”‚
â”‚   â€¢ Cosmos DB: 1000+ RUs + autoscale       â”‚
â”‚   â€¢ Log Analytics: 90-day retention        â”‚
â”‚   â€¢ Private Endpoints: ENABLED             â”‚
â”‚   â€¢ Geo-replication: Active (if 2x RG)    â”‚
â”‚   â€¢ Cost: ~$284/month                      â”‚
â”‚                                            â”‚
â”‚   Use Case:                                â”‚
â”‚   âœ“ Production traffic                    â”‚
â”‚   âœ“ High availability (99.99% SLA)       â”‚
â”‚   âœ“ Compliance & audit trails              â”‚
â”‚   âœ“ Disaster recovery ready                â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Request Flow Sequence Diagram

```
Client          CDN           Function        Key Vault        Cosmos DB
  â”‚              â”‚              App              â”‚                 â”‚
  â”‚              â”‚               â”‚                â”‚                 â”‚
  â”œâ”€ Request â”€â”€â†’ â”‚               â”‚                â”‚                 â”‚
  â”‚ (HTTPS/CORS) â”‚               â”‚                â”‚                 â”‚
  â”‚              â”œâ”€ Route â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚                 â”‚
  â”‚              â”‚                â”‚                â”‚                 â”‚
  â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
  â”‚              â”‚ â”‚ Validate Input               â”‚                 â”‚
  â”‚              â”‚ â”‚ Extract Token from Header   â”‚                 â”‚
  â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
  â”‚              â”‚                â”‚                â”‚                 â”‚
  â”‚              â”‚                â”œâ”€ Token â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                 â”‚
  â”‚              â”‚                â”‚                 â”‚                 â”‚
  â”‚              â”‚                â”‚ â† Secret Value â”€â”¤                 â”‚
  â”‚              â”‚                â”‚                â”‚                 â”‚
  â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
  â”‚              â”‚ â”‚ Build Insert Request         â”‚                 â”‚
  â”‚              â”‚ â”‚ Include Secret in Header    â”‚                 â”‚
  â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
  â”‚              â”‚                â”‚                â”‚                 â”‚
  â”‚              â”‚                â”œâ”€ Create Item â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
  â”‚              â”‚                â”‚  (with auth token)               â”‚
  â”‚              â”‚                â”‚                â”‚                 â”‚
  â”‚              â”‚                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚              â”‚                â”‚ â”‚ Validate RBAC               â”‚ â”‚
  â”‚              â”‚                â”‚ â”‚ Check Role: Data Contributorâ”‚ â”‚
  â”‚              â”‚                â”‚ â”‚ Partition Key: sales        â”‚ â”‚
  â”‚              â”‚                â”‚ â”‚ Create Document            â”‚ â”‚
  â”‚              â”‚                â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚              â”‚                â”‚                â”‚                 â”‚
  â”‚              â”‚                â”‚ â† Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
  â”‚              â”‚ â† Response â”€â”€â”€â”€â”‚                â”‚                 â”‚
  â”‚ â† Response â”€â”€â”¤                â”‚                â”‚                 â”‚
  â”‚ (HTTP 201)   â”‚                â”‚                â”‚                 â”‚
  â”‚              â”‚                â”‚                â”‚                 â”‚
  
Timeline:
T+0ms:   User clicks submit
T+5ms:   Request reaches CDN edge
T+15ms:  Function App cold start (if first call in 5 min)
T+50ms:  Key Vault authentication
T+100ms: Cosmos DB insert
T+150ms: Response sent to client
```

---

**Diagram Version:** 1.0
**Last Updated:** December 2025
